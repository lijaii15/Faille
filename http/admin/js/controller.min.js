app.filter('pic', function() {
    return function(text) {
        if(text!=""&&text!=undefined){
        if(text.substr(0,5)=="media" || text.substr(0,6)=="images"){
        return "../"+text;
    }else{
        return text;
    }}
    }
});

app.controller("admin_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=admin&action=edit&A_id=" + $stateParams.id+"&lang="+lang, "#/app/admin_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=admin&action=add"+"&lang="+lang, "#/app/admin_list/", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=admin_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
} ]);

app.controller("authcode", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
$scope.getauth = function(lang) {
        ajaxx("ajax."+langcode+"?type=config&action=auth", "", $("#auth").serialize(), 2, "");
    };
} ]);

app.controller("admin_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=admin_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.admin_list = response.admin_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=admin&A_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=admin", "", $("#form").serialize(), 4, "");
        });
    };
} ]);

app.controller("config_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", "$modal",function($scope, $http, $state, $stateParams, $sce,$modal) {

    toastr.warning("数据加载中，请稍候..."); 
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $("#hue-demo").val(response.C_m_color);
        $(".minicolors-swatch-color").attr("style","background:"+response.C_m_color);
        toastr.clear();
    });

    $scope.tab0=0;
    $scope.tab2=0;
    $scope.tab3=0;
    $scope.tab4=0;
    $scope.tab5=0;
    $scope.tab6=0;
    $scope.tab7=0;
    $scope.tab8=0;
    $scope.tab9=0;
    $scope.tab10=0;
    $scope.tab11=0;
    $scope.tab12=0;
    $scope.tab13=0;


    switch($stateParams.id){
        case "0":
        $scope.tab0=1;
        break;

        case "1":
        $scope.tab1=1;
        break;

        case "2":
        $scope.tab2=1;
        break;

        case "3":
        $scope.tab3=1;
        break;

        case "4":
        $scope.tab4=1;
        break;

        case "5":
        $scope.tab5=1;
        break;

        case "6":
        $scope.tab6=1;
        break;

        case "7":
        $scope.tab7=1;
        break;

        case "8":
        $scope.tab8=1;
        break;

        case "9":
        $scope.tab9=1;
        break;

        case "10":
        $scope.tab10=1;
        break;

        case "11":
        $scope.tab11=1;
        break;

        case "12":
        $scope.tab12=1;
        break;

        case "13":
        $scope.tab13=1;
        break;

    }

    $scope.save = function(lang) {
    	$("#C_code").val(glcode($("#C_code").val()));
    	$("#C_fenxiang").val(glcode($("#C_fenxiang").val()));
        $("#C_kefuyun").val(glcode($("#C_kefuyun").val()));

        ajaxx("ajax."+langcode+"?type=config&action=edit&lang="+lang, "", $("#form").serialize(), 2, function(){
            $http.get("data."+langcode+"?action=config&lang="+$scope.lang).success(function(response) {
                $scope.data = response;
            });
        });

        $("#C_code").val(glcode2($("#C_code").val()));
    	$("#C_fenxiang").val(glcode2($("#C_fenxiang").val()));
        $("#C_kefuyun").val(glcode2($("#C_kefuyun").val()));

    };

    $scope.mark = function(str) {
       $scope.data.C_mark = str;
    };


    $scope.oss=function(){
        $scope.stop=0;
        toastr.warning("正在计算文件个数"); 
        $http.get("data."+langcode+"?action=oss&lang="+$scope.lang).success(function(response) {
            $scope.response=response;
            $scope.count=response.split("|").length-1;

            ajaxx("ajax."+langcode+"?type=config&action=edit&lang="+$scope.lang, "", $("#form").serialize(), 2, function(){
                $scope.uppic(0);
            });
        });
    };

    $scope.reupload = function() {
        $http.get("ajax."+langcode+"?type=config&action=reupload&lang="+$scope.lang).success(function(response) {
            $scope.oss();
        });
    }

    $scope.ts = function(html) {
    	ajaxx("ajax."+langcode+"?type=config&action=edit&lang="+$scope.lang, "", $("#form").serialize(), 2, function(){
            ajaxx("ajax."+langcode+"?type=config&action=ts&html="+html, "", $("#form").serialize(), 2, "");
        });
    }

    $scope.uppic = function(i) {

        if(i=="stop"){
            $scope.stop=1;
            $("#progressx").hide();
            $("#info").hide();
            $("#stop").hide();
            $("#ossbtn").show();
            toastr.success("上传已停止"); 
            return false;
        }

        if($scope.count==0){
            toastr.success("本地文件上传完毕"); 
            $("#info").show();
            $("#reupload").show();
            $("#info").html("所有文件上传完毕");
        }else{
            if($scope.stop==0){
                $("#progressx").show();
                $("#info").show();
                $("#stop").show();
                $("#ossbtn").hide();
                $("#reupload").hide();

                if(i==0){
                    toastr.warning("正在上传中，请勿关闭页面..."); 
                }

                $.ajax({
                    type: "post",
                    url: "ajax."+langcode+"?type=config&action=uppic&file="+$scope.response.split("|")[i],
                    data: "1",
                    success: function(data) {
                        if(data=="success"){
                            $("#progress").attr("style","width: "+((i+1)/$scope.count)*100+"%");
                            $("#progress").html((((i+1)/$scope.count)*100).toFixed(2)+"%");
                            if(i<$scope.count-1){
                                $("#info").html("<span style='color:#009900'>已上传"+i+"个文件（共"+$scope.count+"个），正在上传 "+$scope.response.split("|")[i]+"</span>");
                                $scope.uppic(i+1);
                            }else{
                                $("#reupload").show();
                                $("#info").html("所有文件上传完毕");
                                toastr.clear();
                                toastr.success("本地文件上传完毕"); 
                            }
                        }else{
                            toastr.clear();
                            toastr.error("OSS信息配置有误，请重新检查"); 
                        }
                    },
                    error:function(data) {
                        $scope.uppic(i+1);
                    }
                })
            }
        }
    };

    $scope.testmail=function(){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">测试邮箱功能</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form style="padding:10px;" id="mail"><input type="text" class="form-control" name="data1" placeholder="收件人" style="margin-bottom:10px;"><input type="text" class="form-control" name="data2" placeholder="邮件主题" style="margin-bottom:10px;"><textarea type="text" class="form-control" name="data3" placeholder="测试邮件内容" style="margin-bottom:10px;"></textarea><button class="btn btn-info" ng-click="mail()">测试发送</button> *测试前请先配置好邮箱及授权码</form>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }

    $scope.testmobile=function(){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">测试短信功能</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form style="padding:10px;" id="mobile"><input type="text" class="form-control" name="data1" placeholder="手机号码" style="margin-bottom:10px;"><button class="btn btn-info" ng-click="mobile()">测试发送</button> *测试前请先配置好企业ID/帐号/密码</form>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }

    $scope.buy=function(id){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">购买短信包</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/sms?id='+id+'" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }

    $scope.settab = function(id) {
        if (id == $stateParams.id) {
            return true;
        } else {
            return "";
        }
    };
} ]);


app.controller("creatapp_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", "$modal",function($scope, $http, $state, $stateParams, $sce,$modal) {


$http.get("data."+langcode+"?action=plug"+"&lang="+$scope.lang).success(function(response) {

$scope.kt=function(){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">开通APP</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/payx?domain=' + response.domain + "&product=k&url=" + response.url + '" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }

$scope.creat=function(){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">生成APP</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/payx/app.php?domain=' + response.domain + "&product=app&url=" + response.url + '" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }


})
}]);

app.controller("wxapp_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", "$modal",function($scope, $http, $state, $stateParams, $sce,$modal) {

    $scope.wxapp_creat=false;
    $http.get("data."+langcode+"?action=wxapp_json").success(function(msg) {
            $scope.wxapp_list = msg.list;
        });
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $("#hue-demo").val(response.C_wxcolor);
        $(".minicolors-swatch-color").attr("style","background:"+response.C_wxcolor);
    });
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu_lists = response.main_menu;
    });
    $http.get("data."+langcode+"?action=wxapp"+"&lang="+$scope.lang).success(function(response) {
        $scope.tabs = response.tabs;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=wxapp&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $http.get("data."+langcode+"?action=wxapp"+"&lang="+$scope.lang).success(function(response) {
        $scope.tabs = response.tabs;
        $scope.wxapp_creat=true;
    });
    };

    $scope.creat = function(no,color) {
        $http.get("ajax."+langcode+"?type=wxapp&action=creat"+"&P_no="+no+"&color="+color.replace("#","@")).success(function(response) {
        if(response.split("|")[0]=="success"){
            toastr.success(response.split("|")[1]);
            window.location="http://www.s-cms.cn/wxapp/down/"+$scope.domain.replace(/:/,"_")+"_"+no+".tar";
        }else{
            toastr.error(response.split("|")[1]);
        }
    });
    };
$http.get("data."+langcode+"?action=plug"+"&lang="+$scope.lang).success(function(response) {
$scope.kt=function(){
        var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">开通小程序</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/payx?domain=' + response.domain + "&product=p&url=" + response.url + '" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
    }
})
    $scope.isSelected3 = function(str1, str2) {
        str1 = "," + str1 + ",";
        str2 = "," + str2 + ",";
        if (str1.indexOf(str2) >= 0) {
            return true;
        } else {
            return false;
        }
    };
}]);

app.controller("config2_Ctrl", [ "$scope", "$http", function($scope, $http) {

    

    $http.get("data."+langcode+"?action=config2"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=config2&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("contact_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=contact&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };

    $http.get("data."+langcode+"?action=m_config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data2 = response;
    });

    $http.get("data."+langcode+"?action=contact"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.C_content);
        })
    });
} ]);

app.controller("content_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=content&action=edit&C_id=" + $stateParams.id+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=content&action=edit&C_id=" + $stateParams.id+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=content&action=add"+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=content&action=add"+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=content_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=form_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.form_list = response.form_list;
    });
    $http.get("data."+langcode+"?action=content_list"+"&lang="+$scope.lang+"&id="+$stateParams.id).success(function(response) {
        $scope.content_list = response.content_list;
        $scope.F_title = response.F_title;
    });
} ]);

app.controller("file_Ctrl", [ "$scope", "$http", "$state", "$modal", "$stateParams", "$sce", function($scope, $http, $state, $modal, $stateParams, $sce) {
    $http.get("data."+langcode+"?action=file"+"&lang="+$scope.lang).success(function(response) {
        $scope.file_list = response.file_list;
    });
    $scope.do = function(str, name, id) {
        if (str == 0) {
            swal({
                title:"",
                text:"确定要删除吗？",
                type:"warning",
                showCancelButton:true
            }, function() {
                ajaxx("ajax."+langcode+"?action=del&type=file&name=" + name + "&id=" + id, "", "", 4, "");
            });
        }
    };


    $scope.use = function(str) {
        if (str == 0) {
            return "<i class='fa fa-times-circle'></i> 删除";
        } else {
            return "<i class='fa fa-check-circle'></i> 使用中";
        }
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=file", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.show = function(a,b) {
        var modalInstance = $modal.open({
            template:'<div class="modal-header"><span style="font-size:14px;">查看图片</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="text-align:center;padding:10px;"><img src="' + a + '" style="max-width:100%;max-height:500px;margin-bottom:10px;"><p>文件名称：'+b+'</p></div>',
            controller:"ModalInstanceCtrl",
            size:"lg"
        });
    };
} ]);

app.controller("forgot_ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $scope.user = {};
    $scope.authError = null;
    $scope.found = function() {
        $scope.authError = null;
        // Try to login
        $http.get("ajax."+langcode+"?type=found&email=" + $scope.email+"&lang="+$scope.lang).success(function(response) {
            if (response != "success") {
                $scope.authError = response;
            } else {
                $scope.isCollapsed = !$scope.isCollapsed;
            }
        });
    };
} ]);

app.controller("form_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=form&action=edit&F_id=" + $stateParams.id+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=form&action=edit&F_id=" + $stateParams.id+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=form&action=add"+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=form&action=add"+"&lang="+lang, "#/app/form_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=form_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=form_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.form_list = response.form_list;
    });
    $http.get("data."+langcode+"?action=qsort_list&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort = response.qsort_list;
    });
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu_lists = response.main_menu;
    });
    $http.get("js/tags.txt").success(function(response) {
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='F_title']").keyup(function() {
            $("input[name='F_keywords']").val(lastIndexDemo($("input[name='F_title']").val()));
        });
    });
} ]);

app.controller("form_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    $http.get("data."+langcode+"?action=form_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.form_list = response.form_list;
    });
    $scope.delf = function(id) {
        swal({
            title:"",
            text:"确定要删除吗（该表单下条目也会同时删除）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=form&F_id=" + id, "", "", 4, "f" + id);
        });
    };
    $scope.delc = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=content&C_id=" + id, "", "", 4, "c" + id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=content", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.addmenu = function(id) {
        ajaxx("ajax."+langcode+"?action=addmenu&type=form&F_id=" + id, "", "", 2, id);
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=form"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $scope.creat = function(id) {
        ajaxx("ajax."+langcode+"?action=creat&type=form&F_id=" + id, "excel/" + id + ".xls", $("#form").serialize(), 1, "");
    };
} ]);

app.controller("guestbook_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=guestbook"+"&lang="+$scope.lang).success(function(response) {
        $scope.guestbook = response.guestbook;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=guestbook&G_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=guestbook", "", $("#form").serialize(), 4, "");
        });
    };
} ]);

app.controller("index_Ctrl", [ "$scope", "$http","$modal", function($scope, $http,$modal) {

    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        qrcode.makeCode('http://'+$scope.data.C_domain);
    });


    $http.jsonp("https://www.s-cms.cn/access.php?action=notice&callback=JSON_CALLBACK").success(function(response) {
        $scope.notice = response.notice;
        $scope.version = response["version_"+langcode];
    });

    $scope.show=function(id){
$http.jsonp("https://www.s-cms.cn/access.php?action=notice_info&id="+id+"&callback=JSON_CALLBACK").success(function(response) {

var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">'+response.N_title+' ['+response.N_date+']</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="padding:10px;">'+response.N_content+'</div>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
    });
    }

    $scope.ismobile = function() {
        try {
            var urlhash = window.location.hash;
            if (!urlhash.match("fromapp")) {
                if (navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)) {
                    return true;
                }
            }
        } catch (err) {}
    };
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=guestbook&G_id=" + id, "", "", 4, id);
        });
    };


$scope.editadmin = function(admin) {
    var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">修改后台路径</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form style="padding:10px;" id="editadmin"><div style="font-size:14px;padding:10px 0;">原始路径：'+admin+'</div><input type="hidden" class="form-control" name="path" value="'+admin+'" style="margin-bottom:10px;"><input type="text" class="form-control" name="adminpath" placeholder="后台路径" id="adminpath" style="margin-bottom:10px;"><button class="btn btn-info" ng-click="editadmin()">确定</button> *请确保有重命名文件夹的权限</form>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
}

    $http.get("data."+langcode+"?action=index_message"+"&lang="+$scope.lang).success(function(response) {
        $scope.messages = response.message;
    });
    $http.get("data."+langcode+"?action=index_orders"+"&lang="+$scope.lang).success(function(response) {
        $scope.orders = response.orders;
    });
    $http.get("data."+langcode+"?action=index_member"+"&lang="+$scope.lang).success(function(response) {
        $scope.member = response.member;
    });


    $http.get("data."+langcode+"?action=index_tj"+"&lang="+$scope.lang).success(function(response) {
        option3 = {
    title : {
        text: '今日访客统计',
        subtext: 'IP数合计：'+response.d+' / 浏览量合计：'+response.c
    },
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:['IP数','浏览量']
    },
    toolbox: {
        feature: {
            saveAsImage: {}
        }
    },
    calculable : true,
    xAxis : [
        {
            type : 'category',
            boundaryGap : false,
            data : ['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23']
        }
    ],
    yAxis : [
        {
            type : 'value'
        }
    ],
    series : [
        {
            name:'IP数',
            type:'line',
            smooth:false,

            data:response.b
        },
        {
            name:'浏览量',
            type:'line',
            smooth:false,

            data:response.a
        }
        
    ]
};             
var myChart3 = echarts.init(document.getElementById('main3')); 
myChart3.setOption(option3); 
    });


    //$http.get("data."+langcode+"?action=index_file"+"&lang="+$scope.lang).success(function(response) {
    //    $scope.files = response.files;
    //});
} ]);


app.controller("query_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=query&action=edit&Q_id=" + $stateParams.id+"&lang="+lang, "#/app/query_list//", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=query&action=add"+"&lang="+lang, "#/app/query_list//", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=query_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.datax = response;
    });
    $http.get("data."+langcode+"?action=qsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort_list = response.qsort_list;
    });
} ]);


app.controller("query_add2_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=query&action=add2"+"&lang="+lang, "#/app/query_list//", $("#form").serialize(), 1, "");
        };
    $http.get("data."+langcode+"?action=qsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort_list = response.qsort_list;
    });
} ]);

app.controller("link_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=link&action=edit&L_id=" + $stateParams.id+"&lang="+lang, "#/app/link_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=link&action=edit&L_id=" + $stateParams.id+"&lang="+lang, "#/app/link_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=link&action=add"+"&lang="+lang, "#/app/link_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=link&action=add"+"&lang="+lang, "#/app/link_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=link_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.datax = response;
    });
    $http.get("data."+langcode+"?action=link_list&lang="+$scope.lang).success(function(response) {
        $scope.link_list = response.link_list;
    });

    $http.get("data."+langcode+"?action=lsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lsort_lists = response.lsort_lists;
    });
} ]);

app.controller("link_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state,$stateParams) {
    $http.get("data."+langcode+"?action=link_list" + "&id=" + $stateParams.x + "&lang="+$scope.lang).success(function(response) {
        $scope.link_list = response.link_list;
    });
    $http.get("data."+langcode+"?action=lsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lsort_lists = response.lsort_lists;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=link&L_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=link", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=link"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);


app.controller("query_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state,$stateParams) {

    $scope.id=$stateParams.id;
    $scope.page=$stateParams.page;
    $http.get("data."+langcode+"?action=query_list&id=" + $stateParams.id + "&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.query_list = response.query_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);

    });
    $http.get("data."+langcode+"?action=qsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort_lists = response.qsort_list;
    });
    $scope.tosort=function(id){
        $scope.id=id;
        $scope.page=1;
        $scope.load();
    }
    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=query&Q_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=query", "", $("#form").serialize(), 4, "");
        });
    };

    $scope.selectPage = function(page) {
        $scope.page=page
        $scope.load();
        };

    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=query"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };

    $scope.load=function(){
        $http.get("data."+langcode+"?action=qsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort_lists = response.qsort_list;
    });
        $http.get("data."+langcode+"?action=query_list&id=" + $scope.id + "&page=" + $scope.page +"&lang="+$scope.lang).success(function(response) {
        $scope.query_list = response.query_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    };

} ]);


app.controller("qsort_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=qsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.qsort_lists = response.qsort_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=qsort&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=qsort", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=qsort"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);


app.controller("lsort_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=lsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lsort_lists = response.lsort_lists;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=lsort&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=lsort", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=lsort"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("lv_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=lv_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lv_list = response.lv_list;
    });
    $http.get("data."+langcode+"?action=fen_add"+"&lang="+$scope.lang).success(function(response) {
        $scope.data2 = response;
    });
    $http.get("data."+langcode+"?action=fen_use"+"&lang="+$scope.lang).success(function(response) {
        $scope.data3 = response;
    });
    $http.get("data."+langcode+"?action=money_use"+"&lang="+$scope.lang).success(function(response) {
        $scope.data4 = response;
    });
    $http.get("data."+langcode+"?action=money_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.money_list = response.money_list;
    });
    $http.get("data."+langcode+"?action=fen_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.fen_list = response.fen_list;
    });
    $http.get("data."+langcode+"?action=invoice_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.invoice_list = response.invoice_list;
    });
    $scope.sh1 = function(a) {
        swal({
            title:"",
            text:"确定要审核通过吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=sh1&type=lv&L_id="+a, "#/app/lv/"+a, "", 1, "");
        });
    };
    $scope.sh2 = function(a) {
        swal({
            title:"",
            text:"确定要审核不通过吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=sh2&type=lv&L_id="+a, "#/app/lv/"+a, "", 1, "");
        });
    };


    $scope.sh3 = function(a) {
        swal({
            title:"",
            text:"确定要审核通过吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=sh1&type=invoice&I_id="+a, "#/app/lv/"+a, "", 1, "");
        });
    };
    $scope.sh4 = function(a) {
        swal({
            title:"",
            text:"确定要审核不通过吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=sh2&type=invoice&I_id="+a, "#/app/lv/"+a, "", 1, "");
        });
    };


    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=lv&L_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=lv", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=lv"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $scope.save2 = function(lang) {
        ajaxx("ajax."+langcode+"?action=save2&type=lv"+"&lang="+lang, "", $("#form2").serialize(), 2, "");
    };
    $scope.save3 = function(lang) {
        ajaxx("ajax."+langcode+"?action=save3&type=lv"+"&lang="+lang, "", $("#form3").serialize(), 2, "");
    };
    $scope.save4 = function(lang) {
        ajaxx("ajax."+langcode+"?action=save4&type=lv"+"&lang="+lang, "", $("#form4").serialize(), 2, "");
    };
} ]);


app.controller("comment_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
$http.get("data."+langcode+"?action=comment_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.comment_list = response.comment_list;
    });

$scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=comment&C_id=" + id, "", "", 4, id);
        });
    };

$scope.sh = function(a,b) {
        swal({
            title:"",
            text:"确定要审核通过吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action="+b+"&type=comment&C_id="+a, "#/app/comment/"+a, "", 1, "");
        });
    };
    
} ]);


app.controller("lsort_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {

    $http.get("data."+langcode+"?action=lsort_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=lsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/lsort_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=lsort&action=add"+"&lang="+lang, "#/app/lsort_list/", $("#form").serialize(), 1, "");
        };
    }
   
} ]);


app.controller("qsort_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {

    $http.get("data."+langcode+"?action=qsort_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=qsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/qsort_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=qsort&action=add"+"&lang="+lang, "#/app/qsort_list/", $("#form").serialize(), 1, "");
        };
    }
   
} ]);

app.controller("lv_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=lv&action=edit&L_id=" + $stateParams.id+"&lang="+lang, "#/app/lv/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=lv&action=add"+"&lang="+lang, "#/app/lv/", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=lv_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
} ]);

app.controller("m_config_Ctrl", [ "$scope", "$http", function($scope, $http) {
    $http.get("data."+langcode+"?action=m_config"+"&lang="+$scope.lang).success(function(response) {
        $scope.datax = response;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=m_config&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("m_config2_Ctrl", [ "$scope", "$http", function($scope, $http) {
    $http.get("data."+langcode+"?action=m_config2"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=m_config2&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("m_slide_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=m_slide&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/m_slide_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=m_slide&action=add"+"&lang="+lang, "#/app/m_slide_list/", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=m_slide_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
} ]);

app.controller("m_slide_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=m_slide_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.slide_list = response.slide_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=m_slide&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=m_slide", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=m_slide"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("member_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {

    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=member&action=edit&M_id=" + $stateParams.id+"&lang="+lang, "#/app/member_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=member&action=add"+"&lang="+lang, "#/app/member_list/", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=member_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $scope.mtype_list = response.mtype_list;
        editor.ready(function() {
            editor.setContent(response.M_info);
        })
    });
} ]);

app.controller("member_list_Ctrl", [ "$scope", "$http", "$state","$stateParams", function($scope, $http, $state,$stateParams) {

    $scope.page=$stateParams.page;
    $http.get("data."+langcode+"?action=member_list&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.member_list = response.member_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);
        
    });

    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };

    $scope.selectPage = function(page) {
        $scope.page=page
        $scope.load();
        };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=news"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $scope.load();
    };


    $scope.search=function(){
        
        $http.get("data."+langcode+"?action=member_search&page=" + $scope.page +"&lang="+$scope.lang+"&S_key="+$("#S_key").val()+"&S_type="+$("#S_type").val()).success(function(response) {
        $scope.member_list = response.member_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    }


    $scope.load=function(){
        
        $http.get("data."+langcode+"?action=member_list&page=" + $scope.page +"&lang="+$scope.lang).success(function(response) {
        $scope.member_list = response.member_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    }

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=member&M_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=member", "", $("#form").serialize(), 4, "");
        });
    };
} ]);


app.controller("need_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.C_need = response.C_need;
    });
    $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=need&action=edit&lang="+lang, "#/app/need/", $("#form").serialize(), 1, "");
        };
} ]);


app.controller("agreement_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=agreement"+"&lang="+$scope.lang).success(function(response) {
        $scope.agreement = response.agreement;
    });
    $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=agreement&action=edit&lang="+lang, "#/app/agreement/", $("#form").serialize(), 1, "");
        };
} ]);

app.controller("menu_add_Ctrl", [ "$scope", "$modal","$http", "$state", "$stateParams", function($scope, $modal,$http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=menu&action=edit&U_id=" + $stateParams.id+"&lang="+lang, "#/app/menu_list/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=menu&action=add"+"&lang="+lang, "#/app/menu_list/", $("#form").serialize(), 1, "");
        };
    }
     $scope.change = function(str) {
        if(str=="link/1"){
            $scope.data.U_link=1;
            $scope.data.t_all="";
        }else{
            $scope.data.U_link=0;
            $scope.data.U_url="";
            $http.get("data."+langcode+"?action=menu_html&html="+str+"&lang="+$scope.lang).success(function(response) {
            $scope.data.t_all = response.t_all;
            $scope.data.w_all = response.w_all;
            $scope.data.U_title = response.T_title;
            $scope.data.U_entitle = response.T_entitle;
            });
        }
     }
     $scope.showmore = function(template) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">新建模块</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="padding:20px"><p>没有合适的模块？新建一个</p><p><button class="btn btn-info" ng-click="goto(\'text_add\')">简介（单页图文）</button> <button class="btn btn-info" ng-click="goto(\'nsort_add\')">新闻（列表+多页图文）</button></p><p><button class="btn btn-info" ng-click="goto(\'psort_add\')">产品（列表+多页图文）</button> <button class="btn btn-info" ng-click="goto(\'form_add\')">表单（万能表单 单页）</button></p></div>',
                controller:"ModalInstanceCtrl",
                size:""
            });
    };
    $scope.showfont = function(template) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">选择图标</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div><iframe src="fontpicker.'+langcode+'" frameborder="0" height="400" width="100%"></iframe></div>',
                controller:"ModalInstanceCtrl",
                size:""
            });
    };
    $http.get("data."+langcode+"?action=menu_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $("#hue-demo").val(response.U_color);
        $(".minicolors-swatch-color").attr("style","background:"+response.U_color);
    });
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.main_menu = response.main_menu;
    });
    $http.get("data."+langcode+"?action=module"+"&lang="+$scope.lang).success(function(response) {
        $scope.modules = response.modules;
    });
} ]);

app.controller("menu_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.main_menu = response.main_menu;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=menu&U_id=" + id, "", "", 4, id);
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=menu"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=menu", "", $("#form").serialize(), 4, "");
        });
    };
} ]);

app.controller("news_add_Ctrl", [ "$scope", "$http", "$state","$modal", "$stateParams", function($scope, $http, $state, $modal,$stateParams) {

    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    $http.get("data."+langcode+"?action=nsort_list2"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });

    if ($stateParams.id !== "") {
        $scope.action = "编辑";

        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=news&action=edit&N_id=" + $stateParams.id+"&lang="+lang, "#/app/news_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=news&action=edit&N_id=" + $stateParams.id+"&lang="+lang, "#/app/news_list///", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=news&action=add"+"&lang="+lang, "#/app/news_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=news&action=add"+"&lang="+lang, "#/app/news_list///", $("#form").serialize(), 2, "");
        };
    }
    $scope.tag = function() {
        $http.get("data."+langcode+"?action=configx").success(function(response) {
        var modalInstance = $modal.open({
            template:'<div class="modal-header"><span style="font-size:14px;">管理标签 [标签使用半角逗号(,)隔开]</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form id="txt"><textarea style="width:100%;height:300px;padding:10px;font-size:15px;" spellcheck="false" name="tag" id="tag">'+response.C_tag+'</textarea><button style="margin:5px;" class="btn btn-info" ng-click="savetag()">保存</button></form>',
            controller:"ModalInstanceCtrl",
            size:"lg"
        });

        modalInstance.result.then(function(selectedItem){
        $scope.selected = selectedItem;
            },function(){
        $http.get("data."+langcode+"?action=news_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data.tag = response.tag;
    });
    });
    });
    };
    $http.get("data."+langcode+"?action=news_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.N_content);
        })
        $("#hue-demo").val(response.N_color);
        $(".minicolors-swatch-color").attr("style","background:"+response.N_color);
    });
    $http.get("data."+langcode+"?action=nsort_list2"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_list = response.nsort_list;
    });
    $http.get("data."+langcode+"?action=lv_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lv_list = response.lv_list;
    });

    $http.get("js/tags.txt").success(function(response) {
        
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='N_title']").keyup(function() {
            $("input[name='N_keywords']").val(lastIndexDemo($("input[name='N_title']").val()));
        });
    });
} ]);


app.controller("bbs_add_Ctrl", [ "$scope", "$http", "$state","$modal", "$stateParams", function($scope, $http, $state, $modal,$stateParams) {

    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    $http.get("data."+langcode+"?action=bsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.bsort_list = response.bsort_list;
    });
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        
        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=bbs&action=edit&B_id=" + $stateParams.id+"&lang="+lang, "#/app/bbs_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=bbs&action=edit&B_id=" + $stateParams.id+"&lang="+lang, "#/app/bbs_list///", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=bbs&action=add"+"&lang="+lang, "#/app/bbs_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=bbs&action=add"+"&lang="+lang, "#/app/bbs_list///", $("#form").serialize(), 2, "");
        };
    }

    $http.get("data."+langcode+"?action=bbs_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.B_content);
        })
    });

} ]);

app.controller("bbs_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
	$scope.id=$stateParams.id;
	$scope.parg=$stateParams.page;
    $http.get("data."+langcode+"?action=bbs_list&id=" + $stateParams.id + "&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.bbs_list = response.bbs_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($stateParams.page < 1 || $stateParams.page > $scope.pages) return;
            if ($stateParams.page > 5) {
                var newpageList = [];
                for (var i = $stateParams.page - 5; i < ($stateParams.page + 5 > $scope.pages ? $scope.pages :$stateParams.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    $http.get("data."+langcode+"?action=bsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.bsort_list = response.bsort_list;
    });
    $scope.selectPage = function(page) {
    	$scope.page=page;
    	$scope.load();
    };
    $scope.tosort = function(id) {
    	$scope.id=id;
    	$scope.page=1;
    	$scope.load();
    };
    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=bbs&B_id=" + id, "", "", 4, id);
            $scope.load();
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=bbs", "", $("#form").serialize(), 4, "");
            $scope.load();
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=bbs"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $scope.load();
    };
    $scope.load=function(){
        $http.get("data."+langcode+"?action=bsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.bsort_list = response.bsort_list;
    });
    	$http.get("data."+langcode+"?action=bbs_list&id=" + $scope.id + "&page=" + $scope.page+"&lang="+$scope.lang).success(function(response) {
        $scope.bbs_list = response.bbs_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    }
} ]);


app.controller("news_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
	$scope.id=$stateParams.id;
	$scope.page=$stateParams.page;
    $http.get("data."+langcode+"?action=news_list&id=" + $stateParams.id + "&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.news_list = response.news_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);
        
    });
    $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });
    $scope.tosort=function(id){
        $scope.id=id;
        $scope.page=1;
        $scope.load();
    }
    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=news&N_id=" + id, "", "", 4, id);
            $scope.load();
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=news", "", $("#form").serialize(), 4, "");
            $scope.load();
        });
    };
    $scope.selectPage = function(page) {
    	$scope.page=page
        $scope.load();
        };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=news"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $scope.load();
    };
    $scope.load=function(){
        $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });
        $http.get("data."+langcode+"?action=news_list&id=" + $scope.id + "&page=" + $scope.page +"&lang="+$scope.lang).success(function(response) {
        $scope.news_list = response.news_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    };
} ]);

app.controller("bsort_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=bsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.bsort_list = response.bsort_list;
    });

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=bsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/bsort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=bsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/bsort_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=bsort&action=add"+"&lang="+lang, "#/app/bsort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=bsort&action=add"+"&lang="+lang, "#/app/bsort_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=bsort_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=lv_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.lv_list = response.lv_list;
    });
    
} ]);



app.controller("nsort_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {

    $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=nsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/nsort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=nsort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/nsort_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=nsort&action=add"+"&lang="+lang, "#/app/nsort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=nsort&action=add"+"&lang="+lang, "#/app/nsort_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=nsort_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu_lists = response.main_menu;
    });
    $http.get("js/tags.txt").success(function(response) {
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='S_title']").keyup(function() {
            $("input[name='S_keywords']").val(lastIndexDemo($("input[name='S_title']").val()));
        });
    });
} ]);


app.controller("bsort_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=bsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.bsort_list = response.bsort_list;
    });

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=bsort&S_id=" + id, "", "", 4, id);
        });
    };
    
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=bsort", "", $("#form").serialize(), 4, "");
        });
    };
    
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=bsort"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);



app.controller("nsort_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除分类吗（该分类下新闻也会同时删除）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=nsort&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.addmenu = function(id) {
        ajaxx("ajax."+langcode+"?action=addmenu&type=nsort&S_id=" + id, "", "", 2, id);
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除分类吗（该分类下新闻也会同时删除）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=nsort", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.savex = function(lang) {
        ajaxx("ajax."+langcode+"?action=savex&type=nsort"+"&lang="+lang, "", $("#formx").serialize(), 2, "");
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=nsort"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("tag_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=tag"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("order_list_Ctrl", [ "$scope", "$http", "$state", "$sce", function($scope, $http, $state, $sce) {
    $http.get("data."+langcode+"?action=order_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.order_list = response.order_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=order&O_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=order", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=order"+"&lang="+lang, "#/app/order_list/" + Date.parse(new Date()), $("#form").serialize(), 2, function(){
           $http.get("data."+langcode+"?action=order_list"+"&lang="+$scope.lang).success(function(response) {
                $scope.order_list = response.order_list;
            }); 
        });
    };
} ]);

app.controller("plug_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$modal", function($scope, $http, $state, $stateParams, $modal) {
    $http.get("data."+langcode+"?action=plug"+"&lang="+$scope.lang).success(function(response) {

        $http.get("data."+langcode+"?action=plug_json").success(function(msg) {
            $scope.plug = msg.list;
        });

        $scope.click = function(str, name, T_type) {
            if($scope.C_from=="free2"){
            swal("","请先购买网站授权！","error")
            }else{
            if (str == 0) {
                var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">购买插件</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/payx?domain=' + response.domain + "&product=" + name + "&url=" + response.url + '" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
            }
        }
        };
    });

    $scope.refresh_plug = function(str) {
        ajaxx("ajax."+langcode+"?action=refresh&type=plug", "", "1", 4, "");
    }

    $scope.button = function(str) {
        if (str == 1) {
            return "<i class='fa fa-check-circle'></i> 已开通";
        }
        if (str == 0) {
            return "<i class='fa fa-shopping-cart'></i> 购买";
        }
    };
} ]);

app.controller("product_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {

    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    $scope.sx=false;
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        

        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=product&action=edit&P_id=" + $stateParams.id+"&lang="+lang, "#/app/product_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=product&action=edit&P_id=" + $stateParams.id+"&lang="+lang, "#/app/product_list///", $("#form").serialize(), 2, "");
        };

    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=product&action=add"+"&lang="+lang, "#/app/product_list///", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=product&action=add"+"&lang="+lang, "#/app/product_list///", $("#form").serialize(), 2, "");
        };

    }

    $scope.showsx = function() {
            $scope.sx=!$scope.sx;
        };

    $scope.dy = function(P_id) {
        $http.get("data."+langcode+"?action=dy"+"&lang="+$scope.lang+"&P_id="+P_id).success(function(response) {
        $scope.data.P_shuxing = "";
        $scope.data.P_shuxing = response.P_shuxing;
    });
        $scope.sx=false;
        };

    $http.get("data."+langcode+"?action=product_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $scope.brand_list = response.brand_list;
        editor.ready(function() {
            editor.setContent(response.P_content);
        })
    });

    $http.get("data."+langcode+"?action=psort_list2&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });

    $http.get("data."+langcode+"?action=sx_list&lang="+$scope.lang).success(function(response) {
        $scope.sx_list = response.sx_list;
    });

    $http.get("js/tags.txt").success(function(response) {
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='P_title']").keyup(function() {
            $("input[name='P_keywords']").val(lastIndexDemo($("input[name='P_title']").val()));
        });
    });
} ]);
app.controller("product_excel_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    $scope.excel = function() {
            ajaxx("ajax."+langcode+"?type=product&action=excel", "#/app/product_list///", $("#form").serialize(), 1, "");
        };
} ]);
app.controller("product_add2_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
} ]);
app.controller("product_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
	$scope.id=$stateParams.id;
	$scope.page=$stateParams.page;
    $http.get("data."+langcode+"?action=product_list&id=" + $stateParams.id + "&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.product_list = response.product_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);

    });
    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
    $scope.tosort=function(id){
    	$scope.id=id;
		$scope.page=1;
        $scope.load();
    }
    $scope.selectPage = function(page) {
    	$scope.page=page;
        $scope.load();
        };
    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=product&P_id=" + id, "", "", 4, id);
            $scope.load();
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=product", "", $("#form").serialize(), 4, "");
            $scope.load();
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=product"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $scope.load();
    };
    $scope.load = function(id,page) {
        $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });

        $http.get("data."+langcode+"?action=product_list&id=" + $scope.id + "&page=" + $scope.page + "&lang=" + $scope.lang).success(function(response) {
        $scope.product_list = response.product_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
    });
    };
} ]);

app.controller("psort_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=psort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/psort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=psort&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/psort_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=psort&action=add"+"&lang="+lang, "#/app/psort_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=psort&action=add"+"&lang="+lang, "#/app/psort_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=psort_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu_lists = response.main_menu;
    });
    $http.get("js/tags.txt").success(function(response) {
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='S_title']").keyup(function() {
            $("input[name='S_keywords']").val(lastIndexDemo($("input[name='S_title']").val()));
        });
    });
} ]);

app.controller("psort_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除分类吗（该分类下产品也会同时删除）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=psort&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.addmenu = function(id) {
        ajaxx("ajax."+langcode+"?action=addmenu&type=psort&S_id=" + id, "", "", 2, id);
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除分类吗（该分类下产品也会同时删除）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=psort", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=psort"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $scope.savex = function(lang) {
        ajaxx("ajax."+langcode+"?action=savex&type=psort"+"&lang="+lang, "", $("#formx").serialize(), 2, "");
    };
} ]);

app.controller("reply_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=guestbook&action=reply&G_id=" + $stateParams.id+"&lang="+lang, "#/app/guestbook/", $("#form").serialize(), 1, "");
    };
    $http.get("data."+langcode+"?action=reply&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
} ]);

app.controller("response_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    $http.get("data."+langcode+"?action=response_list&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=response&R_rid=" + id, "", "", 4, id);
        });
    };
} ]);

function delx(id) {
    swal({
        title:"",
        text:"确定要删除吗？",
        type:"warning",
        showCancelButton:true
    }, function() {
        ajaxx("ajax."+langcode+"?action=del&type=response&R_rid=" + id, "", "", 4, id);
    });
}

function readx(id) {
    ajaxx("ajax."+langcode+"?action=read&type=response&R_rid=" + id, "", $("#form_"+id).serialize(), 2, id);
    $("#" + id).html("已通过");
}

function ready(id) {
    ajaxx("ajax."+langcode+"?action=ready&type=response&R_rid=" + id, "", $("#form_"+id).serialize(), 2, id);
    $("#" + id).html("不通过");
}

app.controller("safe_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$sce", function($scope, $http, $state, $stateParams, $sce) {
    $http.get("data."+langcode+"?action=safe"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=safe&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("search_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=search&key=" + $stateParams.key+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.hide = function(str) {
        if (str == 0) {
            return false;
        } else {
            return true;
        }
    };
} ]);


app.controller("recycle_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=recycle&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    $scope.hide = function(str) {
        if (str == 0) {
            return false;
        } else {
            return true;
        }
    };

    $scope.delete = function(str) {
        swal({
            title:"",
            text:"确定要彻底删除吗（无法恢复）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delete&type=recycle&id="+str, "", "", 4, str);
        });
    };

    $scope.delall = function(str) {
        swal({
            title:"",
            text:"确定要清空吗（无法恢复）？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=recycle&id="+str, "", "", 4, str);
        });
    };

    $scope.recovery = function(str) {
        ajaxx("ajax."+langcode+"?action=recovery&type=recycle&id="+str, "", "", 4, str);
    };

    $scope.recoveryall = function(str) {
        ajaxx("ajax."+langcode+"?action=recoveryall&type=recycle&id="+str, "", "", 4, str);
    };

} ]);

app.controller("send_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=send&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.send = function() {
        ajaxx("ajax."+langcode+"?action=send&type=order", "#/app/order_list/", $("#form").serialize(), 1, "");
    };
} ]);

app.controller("SigninFormController", ["$scope", "$http", "$state",function($scope, $http, $state) {
    $scope.user = {};
    $scope.authError = null;


    $scope.login = function() {
        toastr.warning("登录中，请稍候..."); 
        $scope.authError = null;
        $http({
            method: 'post',
            url: 'ajax.' + langcode + '?type=login',
            data: {
                user: $scope.user.email,
                password: $scope.user.password,
                emailcode: $scope.user.emailcode,
                vcode: $("[name='vcode']").val()
            },
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            transformRequest: function(obj) {
                var str = [];
                for (var p in obj) {
                    str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                }
                return str.join("&");
            }
        }).success(function(response) {
            toastr.clear();
            switch(response.split("|")[0]){

                case "error":
                $scope.authError = "用户名/密码错误！";
                break;

                case "emailcode_error":
                $scope.authError = "邮箱验证码错误！";
                break;

                case "vcode_error":
                $scope.authError = "请拖动滑块进行验证！";
                break;

                case "success":
                $scope.$emit('auth', getCookie("auth")); 
                $state.go("app.index");
                break;

                case "ip_error":
                $scope.authError = "检测到登录IP地址有变动<br>请登录邮箱["+response.split("|")[1]+"]查收验证码";
                $("#emailcode").show();
                break;

                case "ip_error2":
                $scope.authError = "尚未设置安全邮箱，再次点击<b>登录按钮</b>即可登入<br>请尽快到 网站安全 > 安全设置 填写您的安全邮箱";
                $scope.user.emailcode="123456";
                break;

            }

        })
    };
}]);

app.controller("sitemap_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=sitemap"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=sitemap&action=creat"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        $scope.showsitemap = true;
    };
} ]);

app.controller("slide_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=slide&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/slide_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=slide&action=edit&S_id=" + $stateParams.id+"&lang="+lang, "#/app/slide_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=slide&action=add"+"&lang="+lang, "#/app/slide_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=slide&action=add"+"&lang="+lang, "#/app/slide_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=slide_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=slide_list&lang="+$scope.lang).success(function(response) {
        $scope.slide_list = response.slide_list;
    });
    $http.get("data."+langcode+"?action=psort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.psort_lists = response.psort_lists;
    });
} ]);



app.controller("mtype_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=mtype&action=edit&T_id=" + $stateParams.id+"&lang="+lang, "#/app/mtype/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=mtype&action=edit&T_id=" + $stateParams.id+"&lang="+lang, "#/app/mtype/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=mtype&action=add"+"&lang="+lang, "#/app/mtype/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=mtype&action=add"+"&lang="+lang, "#/app/mtype/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=mtype_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.T_content);
        })
    });
    
} ]);


app.controller("brand_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=brand&action=edit&B_id=" + $stateParams.id+"&lang="+lang, "#/app/brand_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=brand&action=edit&B_id=" + $stateParams.id+"&lang="+lang, "#/app/brand_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=brand&action=add&lang="+lang, "#/app/brand_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            ajaxx("ajax."+langcode+"?type=brand&action=add&lang="+lang, "#/app/brand_list/", $("#form").serialize(), 2, "");
        };
    }
    $http.get("data."+langcode+"?action=brand_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.B_content);
        })
    });
    
} ]);



app.controller("slide_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=slide_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.slide_list = response.slide_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=slide&S_id=" + id, "", "", 4, id);
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=slide", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=slide"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);



app.controller("mtype_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=mtype_list&lang="+$scope.lang).success(function(response) {
        $scope.mtype_list = response.mtype_list;
    });

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=mtype&T_id=" + id, "", "", 4, id);
        });
    };

    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=mtype", "", $("#form").serialize(), 4, "");
        });
    };

    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=mtype&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);


app.controller("brand_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=brand_list&lang="+$scope.lang).success(function(response) {
        $scope.brand_list = response.brand_list;
    });

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=brand&B_id=" + id, "", "", 4, id);
        });
    };

    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=brand", "", $("#form").serialize(), 4, "");
        });
    };

    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=brand&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);


app.controller("space_Ctrl", [ "$scope", "$http", "$state", "$stateParams","$modal", "$sce", function($scope, $http, $state, $stateParams,$modal, $sce) {
    $http.get("data."+langcode+"?action=space&folder="+$stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.file_list = response.file_list;
        $scope.size_all = response.size_all;
        $scope.path=$scope.C_dir+ReplaceAll($stateParams.id,".","/");
    });

    $scope.upload=function(){
        a="upload";
        b="../"+ReplaceAll($stateParams.id,".","/");
        
        if(!isNaN(a)){
            tid="#pic_"+a
        }else{
            tid="#"+a
        }

        processid=getID();
        $(tid).parent().append("<input type='file' id='testFile"+a+"' style='display:none;' onchange='aaa(\""+a+"\",\""+b+"\",\"a\")'/>");
        $("#testFile"+a).trigger("click");
    }

    $scope.file=function(type,a){
        switch(type){
            case "folder":
            if($stateParams.id==""){
                location.href="#/app/space/"+a+".";
            }else{
                location.href="#/app/space/"+$stateParams.id+a+".";
            }
            break;
            case "back":
            history.go(-1);
            break;
            case "img":
            var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">文件路径：'+$scope.C_dir+ReplaceAll($stateParams.id,".","/")+a+'</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="text-align:center;padding:10px;"><img src="'+$scope.C_dir+ReplaceAll($stateParams.id,".","/")+a+'" style="max-width:100%;max-height:500px;margin-bottom:10px;"><p>文件名称：'+a+'</p></div>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
            break;
            case "txt":
            $http.get("data."+langcode+"?action=readtxt&folder="+$stateParams.id+"&file="+a+"&lang="+$scope.lang).success(function(response) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">'+$scope.C_dir+ReplaceAll($stateParams.id,".","/")+a+' 在线编辑</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form id="txt"><textarea name="txt" style="padding:20px;width:100%;height:500px;" spellcheck="false">' + response + '</textarea><button style="margin:5px;" class="btn btn-info" ng-click="savetxt(\''+$scope.C_dir+ReplaceAll($stateParams.id,".","/")+a+'\')">保存</button> 提示：没有代码基础请勿随意修改代码文件</form>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
        });
            break;
            default:
            toastr.error("暂不支持在线预览该类型文件！")
            return false;
}
    }
} ]);


app.controller("log_Ctrl", [ "$scope", "$http", "$state", "$stateParams","$modal", "$sce", function($scope, $http, $state, $stateParams,$modal, $sce) {
    $scope.page=$stateParams.page;

    $http.get("data."+langcode+"?action=log&page=" + $stateParams.page+"&lang="+$scope.lang).success(function(response) {
        $scope.log_list = response.log_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $stateParams.page || 1; //当前页
        $scope.isActivePage($stateParams.page || 1);

        
    });

    $scope.selectPage = function(page) {
        $scope.page=page;
        $scope.load();
    };

    $scope.isActivePage = function(page) {
        return $scope.selPage == page;
    };
    $scope.Previous = function() {
        $scope.selectPage($scope.selPage - 1);
    };
    $scope.Next = function() {
        $scope.selectPage(parseInt($scope.selPage) + 1);
    };
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=log&L_id=" + id, "", "", 4, id);
            $scope.load();
        });
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=log", "", $("#form").serialize(), 4, "");
            $scope.load();
        });
    };

    $scope.clear = function() {
        swal({
            title:"",
            text:"确定要清空日志吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=clear&type=log", "", $("#form").serialize(), 4, "");
            $scope.load();
        });
    };



$scope.load = function() {

$http.get("data."+langcode+"?action=log&page=" + $scope.page+"&lang="+$scope.lang).success(function(response) {
        $scope.log_list = response.log_list;
        $scope.count = response.count;
        $scope.pageSize = 10; //每页显示几条
        $scope.pages = Math.ceil($scope.count / $scope.pageSize); //页数
        $scope.newPages = $scope.pages > 10 ? 10 :$scope.pages; //显示的页数
        $scope.pageList = [];
        for (var i = 0; i < $scope.newPages; i++) {
            $scope.pageList.push(i + 1);
        }
        $scope.selPage = $scope.page || 1; //当前页
        $scope.isActivePage($scope.page || 1);
        if (($scope.selPage - 1) * 10 + 11 > $scope.count) {
            $scope.list2 = $scope.count;
        } else {
            $scope.list2 = ($scope.selPage - 1) * 10 + 11;
        }
        
        if ($scope.page < 1 || $scope.page > $scope.pages) return;
            if ($scope.page > 5) {
                var newpageList = [];
                for (var i = $scope.page - 5; i < ($scope.page + 5 > $scope.pages ? $scope.pages :$scope.page + 5); i++) {
                    newpageList.push(i + 1);
                }
                $scope.pageList = newpageList;
            }
        
    });
}

}]);


app.controller("template_all_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$modal", function($scope, $http, $state, $stateParams, $modal) {

    if($stateParams.x==0){
        $scope.tabx = 0;
    }else{
        $scope.tabx = 1;
    }

    $http.get("data."+langcode+"?action=template_all"+"&lang="+$scope.lang).success(function(response) {
        $http.get("data."+langcode+"?action=pc_json").success(function(msg) {
            $scope.pc = msg.list;
            $scope.sort = "all";
        });
        $http.get("data."+langcode+"?action=wap_json").success(function(msg) {
            $scope.wap = msg.list;
        });
        $http.get("data."+langcode+"?action=tsort_json").success(function(msg) {
            $scope.tsort = msg.tsort;
        });
        $scope.click = function(str, name, T_type) {
            if (str == 2) {
                if(name.substr(0,1)=="s"){
                    a=0;
                }else{
                    a=1;
                }

                ajaxx("ajax."+langcode+"?type=template&action=down&T_id=" + name, "#/app/template_list/"+a, $("#form").serialize(), 1, "");
            }
            if (str == 3) {
                if($scope.C_from=="free2"){
                swal("","请先购买网站授权！","error")
                }else{
                var modalInstance = $modal.open({
                    template:'<div class="modal-header"><span style="font-size:14px;">购买模板</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><iframe src="https://www.s-cms.cn/payx?domain=' + response.domain + "&product=" + name + "&url=" + response.url + '" type="1" frameborder="0" height="600" width="100%"></iframe>',
                    controller:"ModalInstanceCtrl",
                    size:"lg"
                });
            }
        }

        };
    });

    $scope.show = function(sort) {
        $scope.sort = sort;
    }

    $scope.isactive = function(str) {
        if(str==$stateParams.x){
            return true;
        }else{
            return false;
        }

    }
    $scope.button = function(str) {
        if (str == 1) {
            return "<i class='fa fa-check-circle'></i> 本地";
        }
        if (str == 2) {
            return "<i class='fa fa-cloud-download'></i> 下载";
        }
        if (str == 3) {
            return "<i class='fa fa-shopping-cart'></i> 购买";
        }
    };
} ]);

app.controller("template_edit_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=template&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $http.get("data."+langcode+"?action=template_edit&T_id=" + $stateParams.id + "&name=" + $stateParams.name+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        $scope.T_html = response.T_html;
    });
} ]);


app.controller("template_html_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=template_html&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
} ]);


app.controller("zmt_api_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=config&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=zmt&action=edit"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };

} ]);


app.controller("zmt_article_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=zmt_article&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    $scope.article = function(lang) {
        ajaxx("ajax."+langcode+"?type=zmt&action=article"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };

} ]);


app.controller("template_list_Ctrl", [ "$scope", "$http", "$state", "$stateParams", "$modal", function($scope, $http, $state, $stateParams, $modal) {

    if($stateParams.x==0){
        $scope.tabx = 0;
    }else{
        $scope.tabx = 1;
    }
        
    $http.get("data."+langcode+"?action=template_list"+"&lang="+$scope.lang).success(function(response) {

        $scope.template_list = response.template_list;
    });
    $http.get("data."+langcode+"?action=wap_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.wap_list = response.wap_list;
    });
    $http.get("data."+langcode+"?action=config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id, typex) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=template&T_id=" + id + "&typex=" + typex, "", "", 4, id);
        });
    };
    $scope.sql = function(id) {
        swal({
            title:"",
            text:"将删除您的现有数据并导入模板自带数据<span style='color:#FF0000'>【谨慎操作】</span>，是否继续？",
            html: true,
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=sql&type=template&T_id=" + id, "", "", 2,"");
        });
    };
    $scope.refresh = function(id) {
        swal({
            title:"",
            text:"是否更新模板文件？（不会影响自定义设置）",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=refresh&type=template&T_id=" + id, "", "", 2,"");
        });
    };
    $scope.save = function(typex,id) {
        ajaxx("ajax."+langcode+"?type=template&action=save&typex=" + typex, "", $("#" + typex).serialize(), 2, "");
    if(typex=="template"){
    	$scope.data.C_template = id;
        $scope.$emit('template', id);
    }
    if(typex=="wap"){
        $scope.$emit('wap', id);
    }
    $http.get("data."+langcode+"?action=template_sort&typex="+typex+"&id="+id+"&lang="+$scope.lang).success(function(response) {
        $scope.$emit('sort', response.template_sort);
    });
    };
    $scope.readme = function(template) {
        $http.get("data."+langcode+"?action=readme&id=" + template+"&lang="+$scope.lang).success(function(response) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">模板信息</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="padding:20px">' + response + "</div>",
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
        });
    };
} ]);

app.controller("text_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {

    UE.delEditor('container');
    var editor = UE.getEditor('container',{autoHeightEnabled: false});

    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;

        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=text&action=edit&T_id=" + $stateParams.id+"&lang="+lang, "#/app/text_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=text&action=edit&T_id=" + $stateParams.id+"&lang="+lang, "#/app/text_list/", $("#form").serialize(), 2, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=text&action=add"+"&lang="+lang, "#/app/text_list/", $("#form").serialize(), 1, "");
        };
        $scope.save2 = function(lang) {
            editor.sync();
            ajaxx("ajax."+langcode+"?type=text&action=add"+"&lang="+lang, "#/app/text_list/", $("#form").serialize(), 2, "");
        };
    }
    

    $http.get("data."+langcode+"?action=text_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.text_list = response.text_list;
    });

    $http.get("data."+langcode+"?action=menu_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu_lists = response.main_menu;
    });

    $http.get("data."+langcode+"?action=text_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        editor.ready(function() {
            editor.setContent(response.T_content);
        })
    });

    $http.get("js/tags.txt").success(function(response) {
        window.keylis = response.split(",");
        window.keydrop = "";
        $("input[name='T_title']").keyup(function() {
            $("input[name='T_keywords']").val(lastIndexDemo($("input[name='T_title']").val()));
        });
    });
} ]);

app.controller("text_list_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    toastr.warning("数据加载中，请稍候"); 
    $http.get("data."+langcode+"?action=text_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.text_list = response.text_list;
        toastr.clear();
    });

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=text&T_id=" + id, "", "", 4, id);
        });
    };
    $scope.addmenu = function(id) {
        ajaxx("ajax."+langcode+"?action=addmenu&type=text&T_id=" + id, "", "", 2, id);
    };
    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=text", "", $("#form").serialize(), 4, "");
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=text"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("collection_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams","$modal", function($scope, $http, $state, $stateParams,$modal) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.showx = false;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=collection&action=edit&C_id=" + $stateParams.id+"&lang="+lang, "#/app/collection/", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.showx = true;
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=collection&action=add"+"&lang="+lang, "#/app/collection/", $("#form").serialize(), 1, "");
        };
    }
    $scope.getcontent = function(url,code) {
        $http.get("data."+langcode+"?action=getcontent&url="+url+"&code="+code).success(function(response) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">获取内容（如果乱码请切换编码）</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><textarea name="txt" style="padding:20px;width:100%;height:500px;" spellcheck="false">' + response + '</textarea>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
        });
    };

    $http.get("data."+langcode+"?action=collection_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });

    $http.get("data."+langcode+"?action=nsort_list"+"&lang="+$scope.lang).success(function(response) {
        $scope.nsort_lists = response.nsort_lists;
    });
} ]);

app.controller("collection_Ctrl", [ "$scope", "$http", "$state","$modal", function($scope, $http, $state,$modal) {
    $http.get("data."+langcode+"?action=collection&lang="+$scope.lang).success(function(response) {
        $scope.collection = response.collection;
        $scope.countx = response.count;
        $scope.i = 0;
    });

    $scope.start = function(id,all) {
    if(all==0){
        console.log("false");
        toastr.warning("正在获取被采集页面列表..."); 
        $http.get("data."+langcode+"?action=pagelist&id=" +id).success(function(response) {
            toastr.clear();
            $scope.pageurl=response;
            $scope.count=response.split("|").length-1;
            $scope.collectall(0,id,0);
        });
    }else{
        console.log("true");
        toastr.warning("正在获取被采集页面列表..."); 
        $http.get("data."+langcode+"?action=pagelist&id=" +$scope.collection[id].C_id).success(function(response) {
            toastr.clear();
            $scope.pageurl=response;
            $scope.count=response.split("|").length-1;
            $scope.collectall(0,$scope.collection[id].C_id,1);
        });
    }
    };

    $scope.collectall = function(i,id,all) {

        $("#img"+id).html("[采集中]<img src='http://www.sucaijishi.com/uploadfile/2013/0527/20130527034920629.gif'>");
        $("#progressx").show();
        $("#info").show();

        if(i==0){
            toastr.warning("正在采集中，请勿关闭页面..."); 
        }

        $.ajax({
            type: "post",
            url: "ajax."+langcode+"?type=collection&action=all&id="+id+"&pageurl="+encodeURI($scope.pageurl.split("|")[i]),
            data: "1",
            success: function(data) {
                
                    $("#progress").attr("style","width: "+((i+1)/$scope.count)*100+"%");
                    $("#progress").html((((i+1)/$scope.count)*100).toFixed(2)+"%");
                    if(i<$scope.count-1){
                    	if(data=="success"){
                        	$("#info").html("<span style='color:#009900'>已采集"+i+"个页面（共"+$scope.count+"个），正在采集 "+$scope.pageurl.split("|")[i]+"</span>");
                        }
                        $scope.collectall(i+1,id,all);
                    }else{
                        $("#img"+id).html("");
                        if(all==1){
                            $scope.i=$scope.i+1;
                            if($scope.i<$scope.countx){
                                $scope.start($scope.i,all);
                            }else{
                                $("#info").html("所有页面采集完毕");
                                toastr.clear();
                                toastr.success("所有页面采集完毕"); 
                            }
                        }else{
                            $("#info").html("所有页面采集完毕");
                            toastr.clear();
                            toastr.success("所有页面采集完毕"); 
                        }
                    }
                
            },
            error:function(data) {
                alert("error");
            }
        })
    };

$scope.test = function(id) {
        $http.get("data."+langcode+"?action=testcontent&id="+id).success(function(response) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">测试执行（仅获取列表页第一篇文章）</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><div style="padding:10px;">' + response +'</div>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
        });
    };


    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=collection&C_id=" + id, "", "", 4, id);
        });
    };

    $scope.delall = function() {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=delall&type=collection", "", $("#form").serialize(), 4, "");
        });
    };
} ]);


app.controller("tk_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=send&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.tk = function(action) {
        ajaxx("ajax."+langcode+"?action=" + action + "&type=order&O_id=" + $stateParams.id, "#/app/order_list/", "", 1, "");
    };
} ]);

app.controller("tohtml_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {

    $http.get("data."+langcode+"?action=tohtml").success(function(response) {
        $scope.data = response;
    });

    $scope.creatall = function(i) {
        if(i==0){
            toastr.warning("正在生成中，请勿关闭页面..."); 
        }
        $.ajax({
            type: "post",
            url: "data."+langcode+"?action=creatall&file="+$scope.data.list.split(",")[i],
            data: $("#form").serialize(),
            success: function(data) {
                if(data=="success"){
                    $("#progress").attr("style","width: "+((i+1)/$scope.data.count)*100+"%");
                    $("#progress").html((((i+1)/$scope.data.count)*100).toFixed(2)+"%");
                    if(i<$scope.data.count-1){
                        $scope.creatall(i+1);
                    }else{
                        toastr.clear();
                        toastr.success("静态文件生成完毕"); 
                    }
                }else{
                    toastr.clear();
                    toastr.error(data); 
                }
            },
            error:function(data) {
                alert("error");
            }
        })
    };

    $scope.creat = function(id) {
        ajaxx("ajax."+langcode+"?action=creat&type=tohtml&T_id=" + id, "", $("#form").serialize(), 2, id);
    };

} ]);

app.controller("w_config_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?type=w_config&action=edit"+"&lang="+lang, "#/app/text_list/", $("#form").serialize(), 2, "");
    };
    $scope.getip = function() {
    $http.get("data."+langcode+"?action=getip").success(function(response) {
        swal({
            title:"",
            text:response
        })
    });
    }
    toastr.warning("数据加载中，请稍候"); 
    $http.get("data."+langcode+"?action=w_config"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        toastr.clear();
    });
} ]);

app.controller("w_event_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=w_event"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=w_event&E_id=" + id, "", "", 4, id);
        });
    };
} ]);

app.controller("w_event_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_event&action=edit&E_id=" + $stateParams.id+"&lang="+lang, "#/app/w_event", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_event&action=add"+"&lang="+lang, "#/app/w_event", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=w_event_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.isSelected3 = function(str1, str2) {
        str1 = "," + str1 + ",";
        str2 = "," + str2 + ",";
        if (str1.indexOf(str2) >= 0) {
            return true;
        } else {
            return false;
        }
    };
} ]);

app.controller("w_member_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=w_msg"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.refresh = function() {
        ajaxx("ajax."+langcode+"?type=w_menu&action=refresh", "#/app/w_member/"+Math.random(), $("#form").serialize(), 1, "");
    }
} ]);

app.controller("w_menu_Ctrl", [ "$scope", "$http", "$state", function($scope, $http, $state) {
    $http.get("data."+langcode+"?action=w_menu"+"&lang="+$scope.lang).success(function(response) {
        $scope.main_menu = response.menu_list;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=w_menu&W_id=" + id, "", "", 4, id);
        });
    };
    $scope.save = function(lang) {
        ajaxx("ajax."+langcode+"?action=save&type=w_menu"+"&lang="+lang, "", $("#form").serialize(), 2, "");
    };
    $scope.send = function() {
        ajaxx("ajax."+langcode+"?action=send&type=w_menu", "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("w_menu_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_menu&action=edit&W_id=" + $stateParams.id+"&lang="+lang, "#/app/w_menu", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_menu&action=add"+"&lang="+lang, "#/app/w_menu", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=w_menu_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
        
    });
    $http.get("data."+langcode+"?action=w_menu"+"&lang="+$scope.lang).success(function(response) {
        $scope.menu = response.menu_list;
    });
    $http.get("data."+langcode+"?action=w_reply"+"&lang="+$scope.lang).success(function(response) {
        $scope.event = response.event;
    });

} ]);

app.controller("w_msg_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=w_msg"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.send = function() {
        ajaxx("ajax."+langcode+"?action=send&type=w_msg", "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("w_reply_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=w_reply"+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=w_reply&R_id=" + id, "", "", 4, id);
        });
    };
    $scope.sub = function() {
        ajaxx("ajax."+langcode+"?type=w_reply&action=sub", "", $("#form").serialize(), 2, "");
    };
} ]);

app.controller("w_reply_add_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    if ($stateParams.id !== "") {
        $scope.action = "编辑";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_reply&action=edit&R_id=" + $stateParams.id+"&lang="+lang, "#/app/w_reply", $("#form").serialize(), 1, "");
        };
    } else {
        $scope.action = "新增";
        $scope.save = function(lang) {
            ajaxx("ajax."+langcode+"?type=w_reply&action=add"+"&lang="+lang, "#/app/w_reply", $("#form").serialize(), 1, "");
        };
    }
    $http.get("data."+langcode+"?action=w_reply_add&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
    $http.get("data."+langcode+"?action=w_reply"+"&lang="+$scope.lang).success(function(response) {
        $scope.event = response.event;
    });
} ]);

app.controller("wuliu_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $http.get("data."+langcode+"?action=wuliu&id=" + $stateParams.id+"&lang="+$scope.lang).success(function(response) {
        $scope.data = response;
    });
} ]);
app.controller("sql_Ctrl", [ "$scope", "$http", "$state", "$stateParams", function($scope, $http, $state, $stateParams) {
    $scope.sql = function() {
            ajaxx("ajax."+langcode+"?type=sql&action=sql", "", $("#form").serialize(), 2, "");
        };
    $scope.mdb = function() {
        $http.get("ajax."+langcode+"?type=mdb"+"&lang="+$scope.lang).success(function(response) {
        window.location="download."+langcode+"?DownName="+response;
    });
        };
        $scope.clear = function(lang) {
            ajaxx("ajax."+langcode+"?type=sql&action=clear"+"&lang="+lang, "", $("#form").serialize(), 2, "");
        };

    $scope.download = function(str) {
            window.location="download."+langcode+"?DownName="+str;
        };

} ]);
app.controller("data_Ctrl", [ "$scope", "$http", "$state", "$stateParams","$modal", function($scope, $http, $state, $stateParams,$modal) {
    $http.get("data."+langcode+"?action=sql_list&lang="+$scope.lang).success(function(response) {
        $scope.sql_list = response.sql_list;
        $scope.table = response.table;
    });
    $scope.readsql = function(sql) {
        $http.get("data."+langcode+"?action=readsql&id=" + sql+"&lang="+$scope.lang).success(function(response) {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">SQL文件</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><textarea style="padding:20px;width:100%;height:500px;" spellcheck="false">' + response + "</textarea>",
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
        });
    };
    $scope.toaccess = function() {
        ajaxx("ajax."+langcode+"?type=toaccess", "", $("#form").serialize(), 2, "");
        $scope.$emit('db', 'access');
        };

    $scope.edittable = function() {
        ajaxx("ajax."+langcode+"?type=data&action=edittable", "", $("#form3").serialize(), 2, "");
    };

    $scope.tomysql = function() {
        ajaxx("ajax."+langcode+"?type=tomysql", "download."+langcode+"?DownName=mysql.sql", $("#form").serialize(), 3, "");
        };

    $scope.tosql = function() {
            var modalInstance = $modal.open({
                template:'<div class="modal-header"><span style="font-size:14px;">一键转MSSQL数据库</span> <button class="btn btn-info btn-xs pull-right" ng-click="cancel()">×</button></div><form style="padding:10px;" id="sql"><input type="text" class="form-control" name="data1" placeholder="数据库主机地址" style="margin-bottom:10px;"><input type="text" class="form-control" name="data2" placeholder="数据库名" style="margin-bottom:10px;"><input type="text" class="form-control" name="data3" placeholder="用户名" style="margin-bottom:10px;"><input type="text" class="form-control" name="data4" placeholder="密码" style="margin-bottom:10px;"><button class="btn btn-info" ng-click="tosqll()">确定</button></form>',
                controller:"ModalInstanceCtrl",
                size:"lg"
            });
    };
    $scope.dataup = function() {
        swal({
            title:"",
            text:"导入数据将覆盖网站原有数据，是否继续？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?type=data&action=dataup", "", $("#form").serialize(), 2, "");
        });
        };
    $scope.refresh = function(str) {
        swal({
            title:"",
            text:"导入数据将覆盖网站原有数据，是否继续？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?type=data&action=dataup", "", "data=backup/"+str+".txt", 2, "");
        });
        };
    $scope.datadown = function() {
            ajaxx("ajax."+langcode+"?type=data&action=datadown", "", $("#form2").serialize(), 2, function(){
            	$http.get("data."+langcode+"?action=sql_list&lang="+$scope.lang).success(function(response) {
            		$scope.sql_list = response.sql_list;
            	});
            });
        };
    $scope.download = function(str) {
        $scope.showsql=false;
        window.location="download."+langcode+"?DownName=@@/backup/"+str+".txt";
        };

    $scope.move = function(str) {
        var t = "_"+Math.random().toString(36).substr(2);
        if($scope.c.x14=="1"){
        	ajaxx("ajax."+langcode+"?type=data&action=move&t="+t, "", $("#form").serialize(), 2, function(){
                window.location="../backup/web"+t+".zip";
        	});
        }else{
        	toastr.error("尚未开通网站搬家[x14]插件");
        }
    };

    $scope.del = function(id) {
        swal({
            title:"",
            text:"确定要删除吗？",
            type:"warning",
            showCancelButton:true
        }, function() {
            ajaxx("ajax."+langcode+"?action=del&type=data&id=" + id, "", "", 4, id);
        });
    };

} ]);